{% extends "shared/base.html" %} 
{% load static %}

{% block title %}Perfil{% endblock %}

{% block style %}
  <link rel="stylesheet" href="{% static 'accounts/css/shared/profile.css' %}">
{% endblock style %}

{% block main %}
<div class="container">
    <h1 id="title">Meu Perfil</h1>

    <!--Card de usuário-->
    {% if user.is_artisan %}
        {% include 'accounts/partials/_card_profile.html' with url=profile_image_url|default:'accounts/media/semFotoPerfil.jpg' description='imagem do usuário' name=user.name email=user.email tag_user='Vendedor' profile=True %}
    {% else %}
        {% include 'accounts/partials/_card_profile.html' with url=profile_image_url|default:'accounts/media/semFotoPerfil.jpg' description='imagem do usuário' name=user.name email=user.email tag_user='Cliente' profile=True %}
    {% endif %}

    <div class="row justify-content-between gy-4">
        
        <!-- SEÇÃO: MEUS PEDIDOS -->
        <div class="col-12 col-xl-6 margin summary-card">
            <div class="row align-self-center">
                <div class="col">
                    <h3 class="title_section">Meus Pedidos</h3>
                </div>
                <div class="col text-end">
                    <p><a href="{% url 'accounts:orders' %}">Ver todos</a></p>
                </div>
            </div>

            <div class="orders-list">
                {% if last_orders %}
                    {% for order in last_orders %}
                    <div class="card_order_wrapper">
                        {% include 'orders/partials/_order.html' with order_id=order.order_code order_date=order.created_at status=order.status %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-light text-center mt-3" role="alert">
                        Nenhum pedido recente encontrado.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- SEÇÃO: PRODUTOS FAVORITOS -->
        <div class="col-12 col-xl-5 margin summary-card">
            <div class="row align-self-center">
                <div class="col">
                    <h3 class="title_section">Produtos Favoritos</h3>
                </div>
                <div class="col text-end">
                    <p><a href="{% url 'accounts:favorites' %}">Ver todos</a></p>
                </div>
            </div>
            
            <div class="products-grid">
                {% if last_favorites %}
                    {% for prod in last_favorites %}
                        {% include 'products/partials/card.html' with product=prod pk=prod.pk url=prod.image.url description=prod.name price=prod.min_price|default:"Ver Detalhes" favor=True is_favorite=True %}
                    {% endfor %}
                {% else %}
                    <p class="text-muted text-center py-3">Sua lista de desejos está vazia.</p>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}